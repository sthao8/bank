{% extends "base.html" %}

{% block title %}
    Search Customer
{% endblock %}

{% block main %}
    customer search:
    {% include "search/_search_form.html" %}
    <div>
        {% if customers and customers.total > 0 %}
            <!-- Used to dynamically generate get url params for each href -->
            {% set query_params = {
                "sort_order": sort_order,
                "previous_sort_col": sort_col,
                "search_first_name": form.search_first_name.data,
                "search_last_name": form.search_last_name.data,
                "search_city": form.search_city.data
            } %}

            <!-- Add any customer details to be added here -->
            {% set columns = {
                "id": "id",
                "national id": "national_id",
                "first name": "first_name",
                "last name": "last_name",
                "address": "address",
                "city": "city" 
            } %}
            
            Showing page {{ page }} of total {{ customers.pages }} pages

            <table>
                <thead>
                    <tr>
                        <th></th>
                        {% for label, url_param in columns.items() %}
                            <th>
                                <a href="{{ url_for('search.display_search_results', page = page, sort_col = url_param, toggle_order = 'on', **query_params) }}">
                                    {{ label }}
                                </a>
                                {% if sort_col == url_param %}
                                    <i class="bx {{ 'bx-up-arrow' if sort_order == 'asc' else 'bx-down-arrow' }}"></i>
                                {% endif %}
                            </th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for customer in customers %}
                        <tr>
                            <td>{{ loop.index0 + customers.first }}.</td>
                            <td><a href="{{ url_for('customers.customer_page', customer_id = customer.id) }}"> {{ customer.id }} </a></td>
                            {% for label, attribute_name in columns.items() %}
                                {% if attribute_name != "id" %}
                                    <td>{{ customer[attribute_name] }}</td>
                                {% endif %}
                            {% endfor %}
                        </tr>
                    {% endfor %}
                    <tr>
                        {% if customers.has_prev %}
                            <td><a href="{{ url_for('search.display_search_results', page = ( page - 1 ), sort_col = sort_col, toggle_order = '', **query_params ) }}">previous</a></td>
                        {% endif %}
                        {% if customers.has_next %}
                            <td><a href="{{ url_for('search.display_search_results', page = ( page + 1 ), sort_col = sort_col, toggle_order = '', **query_params ) }}">next</a></td>
                        {% endif %}
                    </tr>
                </tbody>
            </table>
        {% elif form.search_first_name.data or form.search_last_name.data or form.search_city.data %}
                no results found!
        {% else %}
                please enter search terms
        {% endif %}
    </div>

{% endblock %}
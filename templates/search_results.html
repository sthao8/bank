{% extends "base.html" %}

{% block title %}
    Search Customer
{% endblock %}

{% block main %}
    customer search:
    {% include "_search_form.html" %}
    <div>
        {% if customers %}
            <!-- Used to dynamically generate get url params for each href -->
            {% set query_params = {
                "sort_order": sort_order,
                "toggle_order": True,
                "previous_sort_col": sort_col,
                "search_first_name": form.search_first_name.data,
                "search_last_name": form.search_last_name.data,
                "search_city": form.search_city.data
            } %}

            <!-- Add any customer details to be added here -->
            {% set columns = {
                "id": "id",
                "national id": "national_id",
                "first name": "first_name",
                "last name": "last_name",
                "address": "address",
                "city": "city" 
            } %}
            
            <table>
                <thead>
                    <tr>
                        <th></th>
                        {% for label, url_param in columns.items() %}
                            <th>
                                <a href="{{ url_for('display_search_results', sort_col=url_param, **query_params) }}">
                                    {{ label }}
                                </a>
                                {% if sort_col == url_param %}
                                    <i class="bx {{ 'bx-up-arrow' if sort_order == 'asc' else 'bx-down-arrow' }}"></i>
                                {% endif %}
                            </th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for customer in customers %}
                        <tr>
                            <td>{{ loop.index }}.</td>
                            {% for label, attribute_name in columns.items() %}
                                {% if attribute_name == "id" %}
                                    <td><a href="{{ url_for('customer_page', customer_id=customer.id) }}"> {{ customer[attribute_name] }} </a></td>
                                {% else %}
                                    <td>{{ customer[attribute_name] }}</td>
                                {% endif %}
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            {% if form.search_first_name.data or form.search_last_name.data or form.search_city.data %}
                no results found!
            {% else %}
                please enter search terms
            {% endif %}
        {% endif %}
    </div>

{% endblock %}